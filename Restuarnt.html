<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ArhGo | Ø­Ø¬Ø² Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</title>
  <link rel="stylesheet" href="assets/css/arhgo.css">
  <script src="assets/js/arhgo.js" defer></script>
  <script src="assets/js/booking-system.js" defer></script>
  <script src="assets/js/restaurants-database.js" defer></script>
  <style>
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    .filters select, .filters input {
      min-width: 160px;
    }
    .restaurant-card {
      padding: 24px;
      border-radius: var(--radius-md);
      background: linear-gradient(135deg, rgba(22, 58, 95, 0.9), rgba(14, 31, 51, 0.95));
      border: 2px solid rgba(55, 214, 192, 0.4);
      box-shadow: var(--shadow-soft);
      transition: all 0.3s ease;
    }
    .restaurant-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-hover);
      border-color: rgba(55, 214, 192, 0.6);
    }
    .restaurant-card h3 {
      margin-bottom: 12px;
      color: #37D6C0;
      font-size: 1.4rem;
    }
    .restaurant-card p {
      color: #F2F9FF;
      line-height: 1.7;
      margin-bottom: 12px;
    }
    .badges {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin: 16px 0;
    }
    .badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
    }
    .badge-info {
      background: rgba(59, 130, 246, 0.1);
      color: #37D6C0;
      border: 1px solid rgba(55, 214, 192, 0.4);
    }
    .badge-success {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
      border: 1px solid rgba(16, 185, 129, 0.3);
    }
    .badge-closed {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
      border: 1px solid rgba(239, 68, 68, 0.3);
    }
    .booking-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 2000;
    }
    .booking-box {
      width: min(520px, 95vw);
      max-height: 90vh;
      overflow-y: auto;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(242, 244, 247, 0.95));
      border-radius: var(--radius-lg);
      border: 2px solid rgba(55, 214, 192, 0.4);
      padding: 30px;
      box-shadow: var(--shadow-elevated);
    }
    .booking-box h3 {
      margin-top: 0;
      color: #37D6C0;
      font-size: 1.6rem;
    }
    .success-message {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
      border: 2px solid rgba(16, 185, 129, 0.3);
      padding: 20px;
      border-radius: var(--radius-md);
      margin-top: 20px;
      text-align: center;
    }
    .booking-id {
      font-family: 'Courier New', monospace;
      background: rgba(59, 130, 246, 0.1);
      padding: 8px 12px;
      border-radius: 8px;
      margin-top: 10px;
      display: inline-block;
    }
  </style>
</head>
<body class="page-hidden">
  <nav class="arhgo-nav">
    <div class="arhgo-logo">ArhGo</div>
    <ul>
      <li><a data-nav href="index.html#home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
      <li><a data-nav href="index.html#features">Ø§Ù„Ù…Ø²Ø§ÙŠØ§</a></li>
      <li><a data-nav href="index.html#planner">Ø®Ø·Ø· Ø±Ø­Ù„ØªÙƒ</a></li>
      <li><a data-nav href="index.html#destinations">Ø§Ù„ÙˆØ¬Ù‡Ø§Øª</a></li>
      <li><a data-nav href="hotel.html">Ø§Ù„ÙÙ†Ø§Ø¯Ù‚</a></li>
      <li><a data-nav href="ticket-booking.html">Ø­Ø¬Ø² Ø§Ù„Ø±Ø­Ù„Ø§Øª</a></li>
      <li><a data-nav href="Restuarnt.html">Ø­Ø¬Ø² Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</a></li>
    </ul>
    <div class="stack">
      <a class="btn btn-ghost" href="login.html" data-flight-sound>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
      <a class="btn btn-gradient" href="signup.html" data-flight-sound>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a>
    </div>
  </nav>
  <main class="page-shell">
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">Ø­Ø¬Ø² Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</h2>
        <p class="section-subtitle">Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ø·Ø§Ø¹Ù… ÙˆØ§Ø­Ø¬Ø² Ø·Ø§ÙˆÙ„ØªÙƒ Ø¨Ø³Ù‡ÙˆÙ„Ø©. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ØªÙØ­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.</p>
      </div>
      <div class="glass-card">
        <div class="filters">
          <select class="arhgo-select" id="visitType">
            <option value="">Ù†ÙˆØ¹ Ø§Ù„Ø²ÙŠØ§Ø±Ø©</option>
            <option value="family">Ø¹Ø§Ø¦Ù„ÙŠØ©</option>
            <option value="single">ÙØ±Ø¯ÙŠØ©</option>
            <option value="business">Ø¹Ù…Ù„</option>
            <option value="romantic">Ø±ÙˆÙ…Ø§Ù†Ø³ÙŠØ©</option>
          </select>
          <input class="arhgo-input" type="number" id="budget" min="1" placeholder="Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© ($)">
          <select class="arhgo-select" id="foodType">
            <option value="">Ù†ÙˆØ¹ Ø§Ù„Ø£ÙƒÙ„</option>
            <option value="arabic">Ø´Ø±Ù‚ÙŠ</option>
            <option value="western">ØºØ±Ø¨ÙŠ</option>
            <option value="seafood">Ø¨Ø­Ø±ÙŠ</option>
            <option value="asian">Ø¢Ø³ÙŠÙˆÙŠ</option>
            <option value="fastfood">ÙˆØ¬Ø¨Ø§Øª Ø³Ø±ÙŠØ¹Ø©</option>
            <option value="italian">Ø¥ÙŠØ·Ø§Ù„ÙŠ</option>
            <option value="mexican">Ù…ÙƒØ³ÙŠÙƒÙŠ</option>
          </select>
          <input class="arhgo-input" type="text" id="location" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
        </div>
        <div class="stack" style="margin-top:16px;justify-content:flex-end;">
          <button class="btn btn-gradient" id="searchBtn">Ø¨Ø­Ø« Ø¹Ù† Ù…Ø·Ø§Ø¹Ù…</button>
        </div>
      </div>
      <div id="list" class="grid" style="margin-top:28px;"></div>
      <div id="empty" class="glass-card" style="display:none; text-align: center; padding: 40px;">
        <p style="font-size: 1.1rem; color: var(--muted);">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬. Ø¬Ø±Ù‘Ø¨ ØªØºÙŠÙŠØ± Ø§Ù„ÙÙ„Ø§ØªØ±.</p>
      </div>
    </section>
  </main>

  <div id="bookingModal" class="booking-modal">
    <div class="booking-box">
      <button class="btn btn-ghost" id="closeModal" style="position:absolute;top:10px;left:10px;">âœ•</button>
      <h3 id="modalRestaurantName">Ø§Ø­Ø¬Ø² Ø·Ø§ÙˆÙ„ØªÙƒ</h3>
      <form id="bookingForm">
        <div class="field">
          <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
          <input class="arhgo-input" id="bookName" type="text" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" required>
        </div>
        <div class="field">
          <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
          <input class="arhgo-input" id="bookPhone" type="tel" placeholder="+964 770 000 0000" required>
        </div>
        <div class="field">
          <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input class="arhgo-input" id="bookEmail" type="email" placeholder="example@mail.com">
        </div>
        <div class="field">
          <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ø®Ø§Øµ *</label>
          <input class="arhgo-input" id="bookPeople" type="number" min="1" max="20" value="2" required>
        </div>
        <div class="field">
          <label>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª *</label>
          <input class="arhgo-input" id="bookDate" type="datetime-local" required>
        </div>
        <div class="field">
          <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ©</label>
          <textarea class="arhgo-textarea" id="bookNotes" placeholder="Ø·Ù„Ø¨Ø§Øª Ø®Ø§ØµØ© (Ù…Ø«Ù„: Ø·Ø§ÙˆÙ„Ø© Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ù†Ø§ÙØ°Ø©ØŒ Ø­Ø³Ø§Ø³ÙŠØ© Ù…Ù† Ø·Ø¹Ø§Ù… Ù…Ø¹ÙŠÙ†ØŒ Ø¥Ù„Ø®)"></textarea>
        </div>
        <button class="btn btn-gradient" type="submit" style="width: 100%; margin-top: 12px;">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²</button>
      </form>
      <div id="successMessage" class="success-message" style="display: none;">
        <h4 style="color: var(--success); margin: 0 0 10px 0;">âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­!</h4>
        <p>Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²:</p>
        <div class="booking-id" id="bookingIdDisplay"></div>
        <div class="action-buttons" style="display: flex; gap: 10px; margin-top: 15px;">
          <button class="btn btn-gradient" onclick="printRestaurantBooking()" style="flex: 1;">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„</button>
          <button class="btn btn-ghost" onclick="closeBookingModal()" style="flex: 1;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const list = $('list');
    const empty = $('empty');
    let currentBooking = null;
    let currentRestaurant = null;

    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ

    const stars = (rating) => 'â˜…'.repeat(Math.floor(rating)) + (rating % 1 >= 0.5 ? 'Â½' : '') + 'â˜†'.repeat(5 - Math.ceil(rating));
    
    const isOpen = (hours) => {
      const h = new Date().getHours();
      const open = hours.open;
      let close = hours.close === 0 ? 24 : hours.close;
      return open < close ? h >= open && h < close : h >= open || h < close;
    };

    function renderList(data) {
      if (!data.length) {
        list.innerHTML = '';
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';
      list.innerHTML = data.map(item => `
        <article class="restaurant-card">
          <h3>${item.name}</h3>
          <p>${item.desc}</p>
          <div class="badges">
            <span class="badge badge-info">${stars(item.rating)} ${item.rating.toFixed(1)}</span>
            <span class="badge ${isOpen(item.hours) ? 'badge-success' : 'badge-closed'}">
              ${isOpen(item.hours) ? 'ğŸŸ¢ Ù…ÙØªÙˆØ­ Ø§Ù„Ø¢Ù†' : 'ğŸ”´ Ù…ØºÙ„Ù‚'}
            </span>
            <span class="badge badge-info">${item.priceRange}</span>
            <span class="badge badge-info">ğŸ“ ${item.location}${item.country ? ', ' + item.country : ''}</span>
          </div>
          <div class="stack" style="margin-top:16px;">
            <button class="btn btn-gradient" onclick="openBooking(${item.id}, '${item.name}', '${item.foodType}')" style="flex: 1;">Ø§Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†</button>
          </div>
        </article>
      `).join('');
    }

    async function applyFilters() {
      list.innerHTML = "<div class='glass-card' style='text-align: center; padding: 40px;'>â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø·Ø§Ø¹Ù…...</div>";
      empty.style.display = 'none';
      
      // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¨Ø­Ø« (ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ø®Ø§Ø¯Ù…)
      setTimeout(() => {
        const visitType = $('visitType').value;
        const foodType = $('foodType').value;
        const budget = parseFloat($('budget').value);
        const location = $('location').value.toLowerCase().trim();

        let filtered = restaurantsDatabase.filter(rest => {
          // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø·Ø¹Ø§Ù…
          if (foodType && rest.foodType !== foodType) return false;
          
          // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø¨Ø­Ø« Ù…Ø±Ù† ÙÙŠ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙˆØ§Ù„Ø¯ÙˆÙ„Ø©)
          if (location) {
            const locationMatch = 
              rest.location.toLowerCase().includes(location) ||
              (rest.country && rest.country.toLowerCase().includes(location)) ||
              rest.name.toLowerCase().includes(location);
            if (!locationMatch) return false;
          }
          
          // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
          if (budget) {
            const priceMap = { '$': 30, '$$': 60, '$$$': 100 };
            const maxPrice = priceMap[rest.priceRange] || 50;
            if (budget < maxPrice * 0.7) return false; // Ù…Ø±ÙˆÙ†Ø© ÙÙŠ Ø§Ù„Ø³Ø¹Ø±
          }
          
          return true;
        });

        // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆÙ‚Ø¹ØŒ Ø¬Ø±Ø¨ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø¯ÙˆÙ† ÙÙ„ØªØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹
        if (filtered.length === 0 && location) {
          filtered = restaurantsDatabase.filter(rest => {
            if (foodType && rest.foodType !== foodType) return false;
            return true;
          }).slice(0, 10); // Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 10 Ù†ØªØ§Ø¦Ø¬
        }

        renderList(filtered);
      }, 500);
    }

    window.openBooking = (id, name, foodType) => {
      currentRestaurant = { id, name, foodType };
      $('modalRestaurantName').textContent = `Ø§Ø­Ø¬Ø² Ø·Ø§ÙˆÙ„ØªÙƒ ÙÙŠ ${name}`;
      $('bookingForm').reset();
      $('successMessage').style.display = 'none';
      
      // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„ØªØ§Ø±ÙŠØ® (Ø§Ù„ÙŠÙˆÙ…)
      const now = new Date();
      now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
      $('bookDate').setAttribute('min', now.toISOString().slice(0, 16));
      
      $('bookingModal').style.display = 'flex';
    };

    $('closeModal').addEventListener('click', closeBookingModal);
    $('bookingModal').addEventListener('click', (e) => {
      if (e.target.id === 'bookingModal') closeBookingModal();
    });

    function closeBookingModal() {
      $('bookingModal').style.display = 'none';
      $('bookingForm').reset();
      $('successMessage').style.display = 'none';
      currentBooking = null;
    }

    $('bookingForm').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const name = $('bookName').value.trim();
      const phone = $('bookPhone').value.trim();
      const email = $('bookEmail').value.trim();
      const people = parseInt($('bookPeople').value);
      const date = $('bookDate').value;
      const notes = $('bookNotes').value.trim();

      if (!name || !phone || !people || !date) {
        alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
        return;
      }

      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø±
      const price = bookingSystem.calculateRestaurantPrice(
        currentRestaurant.id,
        people,
        currentRestaurant.foodType
      );

      // Ø­ÙØ¸ Ø§Ù„Ø­Ø¬Ø²
      const bookingData = {
        restaurantId: currentRestaurant.id,
        restaurantName: currentRestaurant.name,
        name,
        phone,
        email: email || null,
        people,
        date,
        notes: notes || null,
        price
      };

      currentBooking = bookingSystem.bookRestaurant(bookingData);
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
      $('bookingIdDisplay').textContent = currentBooking.id;
      $('successMessage').style.display = 'block';
      $('bookingForm').style.display = 'none';

      // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø®Ø§Ø¯Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
      bookingSystem.sendToServer(currentBooking, 'http://localhost:3080/api/restaurants/book').catch(() => {
        // ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·
      });
    });

    function printRestaurantBooking() {
      if (currentBooking) {
        bookingSystem.printBooking(currentBooking);
      }
    }

    $('searchBtn').addEventListener('click', applyFilters);

    // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Enter
    ['visitType', 'budget', 'foodType', 'location'].forEach(id => {
      const el = $(id);
      if (el) {
        el.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') applyFilters();
        });
      }
    });

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    applyFilters();
  </script>
</body>
</html>
