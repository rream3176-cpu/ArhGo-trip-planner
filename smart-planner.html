<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ArhGo | Ù…ÙˆÙ„Ø¯ Ø®Ø·Ø· Ø°ÙƒÙŠ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/arhgo.css">
  <script src="assets/js/arhgo.js" defer></script>
  <script src="assets/js/countries-database.js"></script>
  <script src="assets/js/plan-manager.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    body {
      background: var(--bg-primary);
      padding-top: 80px;
      font-family: 'Cairo', sans-serif !important;
    }
    
    .planner-container {
      max-width: 900px;
      margin: 0 auto;
      padding: var(--spacing-md) var(--spacing-lg);
      animation: fadeInUp 0.6s ease-out;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .page-header {
      text-align: center;
      margin-bottom: var(--spacing-md);
      animation: fadeInDown 0.6s ease-out 0.2s both;
    }
    
    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .page-header h1 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 4px;
      font-family: 'Cairo', sans-serif;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .page-header h1:hover {
      transform: scale(1.05);
      text-shadow: 0 0 20px rgba(0, 229, 255, 0.5);
    }
    
    .page-header p {
      font-size: 0.9rem;
      color: var(--text-secondary);
      font-family: 'Cairo', sans-serif;
      transition: color 0.3s ease;
    }
    
    .plan-card {
      border-radius: var(--radius-md);
      padding: var(--spacing-md);
      background: linear-gradient(135deg, rgba(20, 27, 45, 0.8) 0%, rgba(15, 22, 36, 0.9) 100%);
      backdrop-filter: blur(30px) saturate(200%);
      -webkit-backdrop-filter: blur(30px) saturate(200%);
      border: 1px solid rgba(0, 229, 255, 0.2);
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.4),
        0 0 0 1px rgba(0, 229, 255, 0.1),
        inset 0 1px 1px rgba(255, 255, 255, 0.1);
      margin-bottom: var(--spacing-md);
      animation: slideInFade 0.8s ease-out 0.3s both;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    @keyframes slideInFade {
      from {
        opacity: 0;
        transform: translateY(40px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    .plan-card:hover {
      transform: translateY(-5px);
      box-shadow: 
        0 30px 80px rgba(0, 0, 0, 0.5),
        0 0 40px rgba(0, 229, 255, 0.3),
        inset 0 1px 1px rgba(255, 255, 255, 0.1);
      border-color: rgba(0, 229, 255, 0.4);
    }
    
    .plan-header {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-md);
      padding-bottom: var(--spacing-sm);
      border-bottom: 1px solid rgba(0, 229, 255, 0.2);
    }
    
    .plan-info-item {
      text-align: center;
      font-family: 'Cairo', sans-serif;
    }
    
    .plan-info-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    
    .plan-info-value {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .day-section {
      margin-bottom: var(--spacing-md);
      padding-bottom: var(--spacing-md);
      border-bottom: 1px solid rgba(0, 229, 255, 0.15);
      animation: fadeInLeft 0.6s ease-out both;
      transition: all 0.3s ease;
    }
    
    .day-section:nth-child(1) { animation-delay: 0.1s; }
    .day-section:nth-child(2) { animation-delay: 0.2s; }
    .day-section:nth-child(3) { animation-delay: 0.3s; }
    .day-section:nth-child(4) { animation-delay: 0.4s; }
    .day-section:nth-child(5) { animation-delay: 0.5s; }
    
    @keyframes fadeInLeft {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    .day-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .day-section:hover {
      transform: translateX(5px);
      border-color: rgba(0, 229, 255, 0.3);
    }
    
    .day-title {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--spacing-sm);
      padding-bottom: var(--spacing-xs);
      border-bottom: 1px solid rgba(0, 229, 255, 0.2);
      font-family: 'Cairo', sans-serif;
      transition: all 0.3s ease;
    }
    
    .day-title:hover {
      color: var(--neon-cyan);
      text-shadow: 0 0 15px rgba(0, 229, 255, 0.5);
    }
    
    .time-slot {
      margin-bottom: var(--spacing-sm);
      transition: all 0.3s ease;
    }
    
    .time-slot:last-child {
      margin-bottom: 0;
    }
    
    .time-slot:hover {
      transform: translateX(5px);
    }
    
    .time-slot-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--neon-cyan);
      margin-bottom: 6px;
      font-family: 'Cairo', sans-serif;
      transition: all 0.3s ease;
    }
    
    .time-slot-title:hover {
      text-shadow: 0 0 10px rgba(0, 229, 255, 0.6);
      transform: translateX(3px);
    }
    
    .time-slot-activities {
      margin-right: var(--spacing-sm);
    }
    
    .activity-item {
      padding: 8px 10px;
      background: rgba(0, 229, 255, 0.08);
      border-radius: 6px;
      margin-bottom: 6px;
      border-right: 2px solid rgba(0, 229, 255, 0.3);
      font-family: 'Cairo', sans-serif;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      animation: fadeInScale 0.4s ease-out both;
    }
    
    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    .activity-item:nth-child(1) { animation-delay: 0.1s; }
    .activity-item:nth-child(2) { animation-delay: 0.2s; }
    .activity-item:nth-child(3) { animation-delay: 0.3s; }
    
    .activity-item:hover {
      transform: translateX(5px) scale(1.02);
      background: rgba(0, 229, 255, 0.15);
      border-color: rgba(0, 229, 255, 0.5);
      box-shadow: 0 5px 15px rgba(0, 229, 255, 0.2);
    }
    
    .activity-item:last-child {
      margin-bottom: 0;
    }
    
    .activity-name {
      font-size: 0.85rem;
      color: var(--text-primary);
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .activity-details {
      font-size: 0.75rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }
    
    .actions {
      display: flex;
      gap: var(--spacing-sm);
      justify-content: center;
      margin-top: var(--spacing-md);
      flex-wrap: wrap;
      animation: fadeInUp 0.6s ease-out 0.5s both;
    }
    
    .actions .btn {
      font-family: 'Cairo', sans-serif;
      font-weight: 600;
      padding: 8px 16px;
      font-size: 0.9rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .actions .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    
    .actions .btn:hover::before {
      width: 300px;
      height: 300px;
    }
    
    .actions .btn:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 10px 30px rgba(0, 229, 255, 0.4);
    }
    
    .actions .btn:active {
      transform: translateY(-1px) scale(1.02);
    }
    
    
    .message {
      text-align: center;
      margin-top: var(--spacing-sm);
      min-height: 20px;
      font-size: 0.85rem;
      font-family: 'Cairo', sans-serif;
      transition: all 0.3s ease;
      animation: slideInMessage 0.4s ease-out;
    }
    
    @keyframes slideInMessage {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @media (max-width: 768px) {
      .planner-container {
        padding: var(--spacing-sm);
      }
      
      .page-header h1 {
        font-size: 1.3rem;
      }
      
      .plan-header {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .day-activities {
        grid-template-columns: 1fr;
      }
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    
    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    @keyframes modalSlideOut {
      from {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
      to {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
      }
    }
    
    #shareModal input,
    #shareModal button {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    #shareModal input:focus {
      outline: none;
      border-color: var(--neon-cyan);
      box-shadow: 0 0 20px rgba(0, 229, 255, 0.3);
      transform: scale(1.02);
    }
    
    #shareModal button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(0, 229, 255, 0.4);
    }
    
    #shareModal button:active {
      transform: translateY(0);
    }
    
    .plan-info-item {
      transition: all 0.3s ease;
    }
    
    .plan-info-item:hover {
      transform: translateY(-3px);
    }
    
    .plan-info-value {
      transition: color 0.3s ease;
    }
    
    .plan-info-item:hover .plan-info-value {
      color: var(--neon-cyan);
      text-shadow: 0 0 10px rgba(0, 229, 255, 0.5);
    }
  </style>
</head>
<body class="page-hidden">
  <nav class="arhgo-nav">
    <div class="arhgo-logo">ArhGo</div>
    <ul>
      <li><a data-nav href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
      <li><a data-nav href="budget-manager.html">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</a></li>
      <li><a data-nav href="smart-alerts.html">Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</a></li>
    </ul>
    <div class="stack" id="authButtons">
      <a class="btn btn-ghost" href="login.html" data-flight-sound id="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
      <a class="btn btn-gradient" href="signup.html" data-flight-sound id="signupBtn">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a>
    </div>
    <div class="stack" id="userProfile" style="display: none; align-items: center; gap: var(--spacing-sm);">
      <span class="user-name" id="userNameDisplay" style="color: var(--neon-cyan); font-weight: 700; font-size: 1rem; white-space: nowrap; text-shadow: 0 0 10px var(--neon-cyan-glow);">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</span>
      <button class="btn btn-ghost" onclick="logoutUser(); location.reload();" style="padding: 8px 16px; font-size: 0.85rem; white-space: nowrap;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>
  </nav>

  <main class="planner-container">
    <div class="page-header">
      <h1>Ù…ÙˆÙ„Ø¯ Ø®Ø·Ø· Ø°ÙƒÙŠ</h1>
      <p>Ø®Ø·Ø© Ø³ÙØ± Ù…Ø­Ø³Ù‘Ù†Ø© ÙˆÙ…Ø®ØµØµØ© Ù„Ùƒ</p>
    </div>

    <div class="plan-card">
      <div class="plan-header" id="tripInfo"></div>
      <div id="dailyPlans"></div>
      </div>
      
    <div class="actions" id="planActions" style="display: none;">
      <button id="savePlanBtn" class="btn btn-gradient">Ø­ÙØ¸ Ø§Ù„Ø®Ø·Ø©</button>
      <button id="sharePlanBtn" class="btn btn-ghost">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø®Ø·Ø©</button>
    </div>

    <div class="message" id="planMessage"></div>
    
    <!-- Modal Ù„Ø¹Ø±Ø¶ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© -->
    <div id="shareModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 10000; align-items: center; justify-content: center;">
      <div style="background: linear-gradient(135deg, rgba(20, 27, 45, 0.95) 0%, rgba(15, 22, 36, 0.98) 100%); padding: 30px; border-radius: 20px; max-width: 500px; width: 90%; border: 2px solid rgba(0, 229, 255, 0.3); box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);">
        <h2 style="color: var(--neon-cyan); margin-bottom: 20px; text-align: center; font-size: 1.5rem;">ğŸ”— Ø±Ø§Ø¨Ø· Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø®Ø·Ø©</h2>
        <div style="margin-bottom: 20px;">
          <label style="color: var(--text-secondary); display: block; margin-bottom: 8px; font-size: 0.9rem;">Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ´Ø§Ø±ÙƒÙ‡:</label>
          <div style="display: flex; gap: 10px;">
            <input type="text" id="shareLinkInput" readonly style="flex: 1; padding: 12px; background: rgba(0, 229, 255, 0.1); border: 2px solid rgba(0, 229, 255, 0.3); border-radius: 8px; color: var(--text-primary); font-size: 0.9rem; font-family: 'Cairo', sans-serif;">
            <button id="copyLinkBtn" style="padding: 12px 20px; background: var(--neon-cyan); color: #0E1F33; border: none; border-radius: 8px; cursor: pointer; font-weight: 700; font-family: 'Cairo', sans-serif; white-space: nowrap;">Ù†Ø³Ø®</button>
          </div>
        </div>
        <div style="text-align: center;">
          <button id="closeShareModal" style="padding: 10px 30px; background: transparent; color: var(--neon-cyan); border: 2px solid var(--neon-cyan); border-radius: 8px; cursor: pointer; font-weight: 600; font-family: 'Cairo', sans-serif;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Ø§Ù„Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙÙŠ Ø¢Ø³ÙŠØ§ ÙÙ‚Ø·
    const arabCountriesAsia = ['Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©', 'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª', 'Ø§Ù„ÙƒÙˆÙŠØª', 'Ù‚Ø·Ø±', 'Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†', 'Ø¹ÙÙ…Ø§Ù†', 'Ø¹Ù…Ø§Ù†', 'Ø§Ù„ÙŠÙ…Ù†', 'Ø§Ù„Ø¹Ø±Ø§Ù‚', 'Ø³ÙˆØ±ÙŠØ§', 'Ø§Ù„Ø£Ø±Ø¯Ù†', 'Ù„Ø¨Ù†Ø§Ù†', 'ÙÙ„Ø³Ø·ÙŠÙ†'];
    
    // Ø¯Ø§Ù„Ø© Ù„ØªØ·Ø¨ÙŠØ¹ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆÙ„Ø© Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
    function normalizeCountryName(name) {
      if (!name) return '';
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø©
      let normalized = name.trim().replace(/\s+/g, '');
      // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­Ø§Ù„Ø§Øª Ø®Ø§ØµØ©: Ø¹ÙÙ…Ø§Ù† Ùˆ Ø¹Ù…Ø§Ù†
      normalized = normalized.replace(/Ø¹ÙÙ…Ø§Ù†/g, 'Ø¹Ù…Ø§Ù†');
      // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø£Ø­Ø±Ù ØºÙŠØ± Ù…Ø±Ø¦ÙŠØ©
      normalized = normalized.replace(/[\u200B-\u200D\uFEFF]/g, '');
      return normalized;
    }
    
    // Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø¯ÙˆÙ„Ø© Ù…Ø¹ÙŠÙ†Ø© Ù…Ù† MySQL
    let countryDataCache = {};
    
    async function getCountryData(countryName) {
      // ØªÙ†Ø¸ÙŠÙ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆÙ„Ø©
      countryName = countryName.trim();
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒØ§Ø´ Ø£ÙˆÙ„Ø§Ù‹
      if (countryDataCache[countryName]) {
        return countryDataCache[countryName];
      }
      
      // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± API
      try {
        console.log('Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¯ÙˆÙ„Ø©:', countryName);
        const response = await fetch(`api/get_country_data.php?country=${encodeURIComponent(countryName)}`);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        
        if (result.success && result.data) {
          // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† API Ø¥Ù„Ù‰ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
          const countryData = {
            cities: result.data.cities || [],
            attractions: {
              cultural: result.data.attractions?.cultural || [],
              nature: result.data.attractions?.nature || [],
              adventure: result.data.attractions?.adventure || [],
              food: result.data.attractions?.food || []
            },
            budget: result.data.budget || { low: 30, medium: 60, high: 120 },
            timeSlots: result.data.timeSlots || {
              morning: '08:00-12:00',
              afternoon: '14:00-17:00',
              evening: '19:00-22:00'
            },
            optimalRoute: result.data.optimalRoute !== undefined ? result.data.optimalRoute : true
          };
          
          // Ø­ÙØ¸ ÙÙŠ Ø§Ù„ÙƒØ§Ø´
          countryDataCache[countryName] = countryData;
          console.log('ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', countryName);
          return countryData;
        } else {
          throw new Error(result.error || 'ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        }
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
        console.error('ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:', error.message);
        // Ø¥Ø±Ø¬Ø§Ø¹ null ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ¬Ø¨ Ø£Ù† ØªØ£ØªÙŠ ÙÙ‚Ø· Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        return null;
      }
    }
    
    // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª ØªÙØµÙŠÙ„ÙŠØ© Ù„Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø³ÙŠØ§Ø­ÙŠØ©
    const placeDetailsDatabase = {
      'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©': {
        'Ø§Ù„Ø±ÙŠØ§Ø¶': {
          cultural: {
            'Ù‚ØµØ± Ø§Ù„Ù…ØµÙ…Ùƒ': {
              description: 'Ù‚Ù„Ø¹Ø© ØªØ§Ø±ÙŠØ®ÙŠØ© ØªØ¹ÙˆØ¯ Ù„Ù„Ù‚Ø±Ù† Ø§Ù„ØªØ§Ø³Ø¹ Ø¹Ø´Ø±ØŒ ÙƒØ§Ù†Øª Ù…Ø³Ø±Ø­Ø§Ù‹ Ù„Ù…Ø¹Ø±ÙƒØ© Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø±ÙŠØ§Ø¶. ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…ØªØ­Ù ÙŠØ¹Ø±Ø¶ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ù…Ù„ÙƒØ© ÙˆØªØ£Ø³ÙŠØ³Ù‡Ø§.',
              activities: ['Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…ØªØ­Ù', 'Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¨ÙˆØ§Ø¨Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ©', 'Ø§Ù„ØªØµÙˆÙŠØ±', 'Ø¬ÙˆÙ„Ø© ÙÙŠ Ø§Ù„Ù‚Ù„Ø¹Ø©'],
              address: 'Ø­ÙŠ Ø§Ù„Ø¯ÙŠØ±Ø©ØŒ Ø§Ù„Ø±ÙŠØ§Ø¶',
              bestTime: '09:00-12:00',
              duration: '2-3 Ø³Ø§Ø¹Ø§Øª',
              tips: 'Ø§Ø­Ø±Øµ Ø¹Ù„Ù‰ Ø§Ø±ØªØ¯Ø§Ø¡ Ù…Ù„Ø§Ø¨Ø³ Ù…Ø±ÙŠØ­Ø© ÙˆØ®Ø° ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ø¹Ùƒ'
            },
            'Ù…ØªØ­Ù Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ²': {
              description: 'Ù…ØªØ­Ù ÙŠÙˆØ«Ù‚ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ù…Ù†Ø° ØªØ£Ø³ÙŠØ³Ù‡Ø§ ÙˆØ­ØªÙ‰ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ø¶Ø±ØŒ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø¹Ø±ÙˆØ¶Ø§Øª Ø£Ø«Ø±ÙŠØ© ÙˆØªØ§Ø±ÙŠØ®ÙŠØ© Ù†Ø§Ø¯Ø±Ø©.',
              activities: ['Ø¬ÙˆÙ„Ø© ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ø±Ø¶', 'Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ©', 'Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØªØ±Ø§Ø«', 'Ø§Ù„ØªØµÙˆÙŠØ±'],
              address: 'Ø­ÙŠ Ø§Ù„Ù…Ø·Ø§Ø±ØŒ Ø§Ù„Ø±ÙŠØ§Ø¶',
              bestTime: '10:00-13:00',
              duration: '2-3 Ø³Ø§Ø¹Ø§Øª',
              tips: 'Ø§Ø­Ø¬Ø² ØªØ°ÙƒØ±ØªÙƒ Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'
            }
          },
          nature: {
            'ÙˆØ§Ø¯ÙŠ Ø­Ù†ÙŠÙØ©': {
              description: 'ÙˆØ§Ø¯ÙŠ Ø·Ø¨ÙŠØ¹ÙŠ Ø®Ù„Ø§Ø¨ ÙŠÙ…ØªØ¯ Ø¹Ø¨Ø± Ø§Ù„Ø±ÙŠØ§Ø¶ØŒ ÙŠÙˆÙØ± Ù…Ø³Ø§Ø­Ø§Øª Ø®Ø¶Ø±Ø§Ø¡ ÙˆØ§Ø³Ø¹Ø© ÙˆÙ…Ù†Ø§Ø·Ù‚ Ù„Ù„ØªÙ†Ø²Ù‡ ÙˆØ§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡.',
              activities: ['Ø§Ù„Ù…Ø´ÙŠ', 'Ø§Ù„ØªÙ†Ø²Ù‡', 'Ø§Ù„ØªØµÙˆÙŠØ±', 'Ø§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡', 'Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©'],
              address: 'ÙˆØ§Ø¯ÙŠ Ø­Ù†ÙŠÙØ©ØŒ Ø§Ù„Ø±ÙŠØ§Ø¶',
              bestTime: '07:00-10:00 Ø£Ùˆ 16:00-19:00',
              duration: '2-3 Ø³Ø§Ø¹Ø§Øª',
              tips: 'Ø§Ø­Ù…Ù„ Ù…Ø§Ø¡ ÙˆÙˆØ§Ù‚ÙŠ Ø´Ù…Ø³ØŒ Ø£ÙØ¶Ù„ ÙˆÙ‚Øª ÙÙŠ Ø§Ù„ØµØ¨Ø§Ø­ Ø§Ù„Ø¨Ø§ÙƒØ±'
            }
          }
        }
      },
      'Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª': {
        'Ø¯Ø¨ÙŠ': {
          cultural: {
            'Ø¨Ø±Ø¬ Ø®Ù„ÙŠÙØ©': {
              description: 'Ø£Ø·ÙˆÙ„ Ù…Ø¨Ù†Ù‰ ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù… Ø¨Ø§Ø±ØªÙØ§Ø¹ 828 Ù…ØªØ±Ø§Ù‹ØŒ ÙŠÙˆÙØ± Ø¥Ø·Ù„Ø§Ù„Ø§Øª Ø¨Ø§Ù†ÙˆØ±Ø§Ù…ÙŠØ© Ø®Ù„Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø¯Ø¨ÙŠ Ù…Ù† Ø§Ù„Ø·Ø§Ø¨Ù‚ 124 Ùˆ148.',
              activities: ['ØµØ¹ÙˆØ¯ Ø§Ù„Ø¨Ø±Ø¬', 'Ù…Ø´Ø§Ù‡Ø¯Ø© Ù…Ù†ØµØ© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©', 'Ø§Ù„ØªØµÙˆÙŠØ± Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰', 'Ø²ÙŠØ§Ø±Ø© Ù†Ø§ÙÙˆØ±Ø© Ø¯Ø¨ÙŠ'],
              address: '1 Sheikh Mohammed bin Rashid Blvd, Dubai',
              bestTime: '17:00-19:00 (Ù„Ø±Ø¤ÙŠØ© Ø§Ù„ØºØ±ÙˆØ¨)',
              duration: '2-3 Ø³Ø§Ø¹Ø§Øª',
              tips: 'Ø§Ø­Ø¬Ø² ØªØ°ÙƒØ±ØªÙƒ Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŒ Ø£ÙØ¶Ù„ ÙˆÙ‚Øª Ø¹Ù†Ø¯ Ø§Ù„ØºØ±ÙˆØ¨'
            },
            'Ù…ØªØ­Ù Ø§Ù„Ù„ÙˆÙØ± Ø£Ø¨ÙˆØ¸Ø¨ÙŠ': {
              description: 'Ù…ØªØ­Ù ÙÙ†ÙŠ Ø¹Ø§Ù„Ù…ÙŠ ÙŠØ¶Ù… Ù…Ø¬Ù…ÙˆØ¹Ø© Ø±Ø§Ø¦Ø¹Ø© Ù…Ù† Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„ÙÙ†ÙŠØ© Ù…Ù† Ù…Ø®ØªÙ„Ù Ø§Ù„Ø­Ø¶Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø«Ù‚Ø§ÙØ§Øª.',
              activities: ['Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…Ø¹Ø§Ø±Ø¶', 'Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„ÙÙ†ÙŠØ©', 'Ø¬ÙˆÙ„Ø© ÙÙŠ Ø§Ù„Ù…ØªØ­Ù', 'Ø§Ù„ØªØµÙˆÙŠØ±'],
              address: 'Ø¬Ø²ÙŠØ±Ø© Ø§Ù„Ø³Ø¹Ø¯ÙŠØ§ØªØŒ Ø£Ø¨ÙˆØ¸Ø¨ÙŠ',
              bestTime: '10:00-13:00',
              duration: '3-4 Ø³Ø§Ø¹Ø§Øª',
              tips: 'Ø§Ø­Ø¬Ø² ØªØ°ÙƒØ±ØªÙƒ Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŒ Ø®Ø° ÙˆÙ‚ØªÙƒ ÙÙŠ Ø§Ù„ØªØ¬ÙˆÙ„'
            }
          },
          nature: {
            'Ø´Ø§Ø·Ø¦ Ø¬Ù…ÙŠØ±Ø§': {
              description: 'Ø´Ø§Ø·Ø¦ Ø±Ø§Ø¦Ø¹ Ù…Ø¹ Ù…ÙŠØ§Ù‡ Ø²Ø±Ù‚Ø§Ø¡ ØµØ§ÙÙŠØ© ÙˆØ±Ù…Ø§Ù„ Ø¨ÙŠØ¶Ø§Ø¡ Ù†Ø§Ø¹Ù…Ø©ØŒ Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡ ÙˆØ§Ù„Ø³Ø¨Ø§Ø­Ø©.',
              activities: ['Ø§Ù„Ø³Ø¨Ø§Ø­Ø©', 'Ø§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡', 'Ø§Ù„ØªØµÙˆÙŠØ±', 'Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ØºØ±ÙˆØ¨', 'Ø±ÙŠØ§Ø¶Ø§Øª Ù…Ø§Ø¦ÙŠØ©'],
              address: 'Ø´Ø§Ø·Ø¦ Ø¬Ù…ÙŠØ±Ø§ØŒ Ø¯Ø¨ÙŠ',
              bestTime: '08:00-11:00 Ø£Ùˆ 16:00-19:00',
              duration: '3-4 Ø³Ø§Ø¹Ø§Øª',
              tips: 'Ø§Ø­Ù…Ù„ ÙˆØ§Ù‚ÙŠ Ø´Ù…Ø³ ÙˆÙ…Ø¸Ù„Ø©ØŒ ØªØ¬Ù†Ø¨ ÙˆÙ‚Øª Ø§Ù„Ø¸Ù‡ÙŠØ±Ø©'
            }
          }
        }
      }
    };
    
    function getPlaceDetails(placeName, city, country, type) {
      // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
      if (placeDetailsDatabase[country] && placeDetailsDatabase[country][city] && 
          placeDetailsDatabase[country][city][type] && 
          placeDetailsDatabase[country][city][type][placeName]) {
        return placeDetailsDatabase[country][city][type][placeName];
      }
      
      // Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ØªÙØµÙŠÙ„ÙŠØ© (Ø¨Ø¯ÙˆÙ† Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ API Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©)
      const descriptions = {
        cultural: `${placeName} Ù‡Ùˆ Ù…Ø¹Ù„Ù… Ø«Ù‚Ø§ÙÙŠ ÙˆØªØ§Ø±ÙŠØ®ÙŠ Ù…Ù‡Ù… ÙÙŠ ${city}ØŒ ${country}. ÙŠÙ‚Ø¯Ù… ØªØ¬Ø±Ø¨Ø© Ø«Ù‚Ø§ÙÙŠØ© ØºÙ†ÙŠØ© ØªØªØ¹Ø±Ù Ù…Ù† Ø®Ù„Ø§Ù„Ù‡Ø§ Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ® ÙˆØªØ±Ø§Ø« Ø§Ù„Ù…Ù†Ø·Ù‚Ø©.`,
        nature: `${placeName} Ù‡Ùˆ Ù…ÙƒØ§Ù† Ø·Ø¨ÙŠØ¹ÙŠ Ø®Ù„Ø§Ø¨ ÙÙŠ ${city}ØŒ ${country}. ÙŠÙˆÙØ± Ø¥Ø·Ù„Ø§Ù„Ø§Øª Ø³Ø§Ø­Ø±Ø© ÙˆÙØ±ØµØ© Ù„Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡ ÙˆØ§Ù„Ø§Ø³ØªÙ…ØªØ§Ø¹ Ø¨Ø¬Ù…Ø§Ù„ Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©.`,
        adventure: `${placeName} ÙŠÙˆÙØ± ØªØ¬Ø±Ø¨Ø© Ù…ØºØ§Ù…Ø±Ø© Ù…Ø«ÙŠØ±Ø© ÙÙŠ ${city}ØŒ ${country}. Ù…ÙƒØ§Ù† Ù…Ø«Ø§Ù„ÙŠ Ù„Ù…Ø­Ø¨ÙŠ Ø§Ù„Ø¥Ø«Ø§Ø±Ø© ÙˆØ§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©.`,
        food: `${placeName} Ù‡Ùˆ Ù…Ø·Ø¹Ù… Ø±Ø§Ù‚ÙŠ ÙÙŠ ${city}ØŒ ${country}. ÙŠÙ‚Ø¯Ù… Ø£Ø·Ø¨Ø§Ù‚Ø§Ù‹ Ù„Ø°ÙŠØ°Ø© ØªÙ…Ø«Ù„ Ø£ÙØ¶Ù„ Ù…Ø§ ØªÙ‚Ø¯Ù…Ù‡ Ø§Ù„Ù…Ø·Ø§Ø¨Ø® Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙˆØ§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©.`
      };
      
      const activitiesList = {
        cultural: ['Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…ÙƒØ§Ù†', 'Ø¬ÙˆÙ„Ø© Ø§Ø³ØªÙƒØ´Ø§ÙÙŠØ©', 'Ø§Ù„ØªØµÙˆÙŠØ±', 'Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø§Øª'],
        nature: ['Ø§Ù„Ù…Ø´ÙŠ', 'Ø§Ù„ØªÙ†Ø²Ù‡', 'Ø§Ù„ØªØµÙˆÙŠØ±', 'Ø§Ù„Ø§Ø³ØªØ±Ø®Ø§Ø¡', 'Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©'],
        adventure: ['Ù…Ù…Ø§Ø±Ø³Ø© Ø§Ù„Ø£Ù†Ø´Ø·Ø©', 'Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©', 'Ø§Ù„ØªØµÙˆÙŠØ±', 'Ø§Ù„Ø§Ø³ØªÙ…ØªØ§Ø¹ Ø¨Ø§Ù„Ø¥Ø«Ø§Ø±Ø©'],
        food: ['ØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ø·Ø¹Ø§Ù…', 'ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø£Ø·Ø¨Ø§Ù‚ Ø§Ù„Ù…Ø­Ù„ÙŠØ©', 'Ø§Ù„Ø§Ø³ØªÙ…ØªØ§Ø¹ Ø¨Ø§Ù„Ø£Ø¬ÙˆØ§Ø¡', 'Ø§Ù„ØªØµÙˆÙŠØ±']
      };
      
      const defaultDetails = {
        description: descriptions[type] || `${placeName} Ù‡Ùˆ Ù…ÙƒØ§Ù† Ø³ÙŠØ§Ø­ÙŠ Ø±Ø§Ø¦Ø¹ ÙÙŠ ${city}ØŒ ${country}. ÙŠÙˆÙØ± ØªØ¬Ø±Ø¨Ø© Ù…Ù…ÙŠØ²Ø© Ù„Ù„Ø²ÙˆØ§Ø±.`,
        activities: activitiesList[type] || ['Ø¬ÙˆÙ„Ø© Ø§Ø³ØªÙƒØ´Ø§ÙÙŠØ©', 'Ø§Ù„ØªØµÙˆÙŠØ±', 'Ø§Ù„Ø§Ø³ØªÙ…ØªØ§Ø¹ Ø¨Ø§Ù„Ù…Ù†Ø§Ø¸Ø±'],
        address: `${city}, ${country}`,
        bestTime: type === 'food' ? '19:00-22:00' : '09:00-17:00',
        duration: type === 'food' ? '2 Ø³Ø§Ø¹Ø§Øª' : '2-3 Ø³Ø§Ø¹Ø§Øª',
        tips: type === 'food' ? 'Ø§Ø­Ø¬Ø² Ø·Ø§ÙˆÙ„Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ø®Ø§ØµØ© ÙÙŠ Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹' : 'Ø§Ø­Ø±Øµ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØµÙˆÙ„ Ù…Ø¨ÙƒØ±Ø§Ù‹ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø§Ø²Ø¯Ø­Ø§Ù…'
      };
      return defaultDetails;
    }

    function optimizeRoute(places, startPoint) {
      if (places.length <= 2) return places;
      const route = [startPoint];
      const remaining = places.filter(p => p !== startPoint);
      let current = startPoint;
      while (remaining.length > 0) {
        let nearest = remaining[0];
        let minDist = Math.random() * 10;
        for (const place of remaining) {
          const dist = Math.random() * 10;
          if (dist < minDist) {
            minDist = dist;
            nearest = place;
          }
        }
        route.push(nearest);
        remaining.splice(remaining.indexOf(nearest), 1);
        current = nearest;
      }
      return route;
    }

    async function generateSmartPlan(country, days, interests, budget) {
      // ØªÙ†Ø¸ÙŠÙ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆÙ„Ø©
      country = country.trim();
      console.log('Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©:', country);
      console.log('Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©:', arabCountriesAsia);
      
      // ØªØ·Ø¨ÙŠØ¹ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆÙ„Ø©
      const normalizedCountry = normalizeCountryName(country);
      console.log('Ø§Ù„Ø¯ÙˆÙ„Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ·Ø¨ÙŠØ¹:', normalizedCountry);
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¯ÙˆÙ„Ø© Ø¹Ø±Ø¨ÙŠØ© ÙÙŠ Ø¢Ø³ÙŠØ§ (Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªÙ„Ø§ÙØ§Øª)
      const isArabCountry = arabCountriesAsia.some(c => {
        const normalizedC = normalizeCountryName(c);
        const matches = normalizedC === normalizedCountry;
        if (matches) {
          console.log(`ØªÙ…Øª Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©: "${c}" Ù…Ø¹ "${country}"`);
        }
        return matches;
      });
      
      console.log('Ù‡Ù„ Ø§Ù„Ø¯ÙˆÙ„Ø© Ø¹Ø±Ø¨ÙŠØ© ÙÙŠ Ø¢Ø³ÙŠØ§ØŸ', isArabCountry);
      
      if (!isArabCountry) {
        console.error('Ø§Ù„Ø¯ÙˆÙ„Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©:', country, 'Ø¨Ø¹Ø¯ Ø§Ù„ØªØ·Ø¨ÙŠØ¹:', normalizedCountry);
        console.error('Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ·Ø¨ÙŠØ¹:', arabCountriesAsia.map(c => normalizeCountryName(c)));
        showMessage('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¯ÙˆÙ„Ø© Ø¹Ø±Ø¨ÙŠØ© ÙÙŠ Ù‚Ø§Ø±Ø© Ø¢Ø³ÙŠØ§ ÙÙ‚Ø·', 'error');
        return [];
      }
      
      const countryData = await getCountryData(country);
      console.log('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø©:', countryData);
      
      if (!countryData) {
        console.error('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¯ÙˆÙ„Ø©:', country);
        showMessage('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙˆÙ„Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¯ÙˆÙ„Ø© Ø¹Ø±Ø¨ÙŠØ© ÙÙŠ Ø¢Ø³ÙŠØ§.', 'error');
        return [];
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
      if (!countryData.attractions || !countryData.budget) {
        console.error('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆÙ„Ø© ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©:', countryData);
        showMessage('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆÙ„Ø© ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'error');
        return [];
      }
      
      const budgetLevel = budget.toLowerCase().includes('Ù…Ù†Ø®ÙØ¶') || budget === 'low' ? 'low' : 
                         budget.toLowerCase().includes('ÙØ§Ø®Ø±') || budget === 'high' ? 'high' : 'medium';
      const dailyBudget = countryData.budget[budgetLevel] || countryData.budget.medium || 60;
      
      const interestsList = interests ? interests.split(',').map(i => i.trim().toLowerCase()).filter(i => i) : [];
      const isCultural = interestsList.length === 0 || interestsList.some(i => ['Ø«Ù‚Ø§ÙØ©', 'ØªØ§Ø±ÙŠØ®', 'Ù…ØªØ­Ù', 'cultural'].includes(i));
      const isNature = interestsList.length === 0 || interestsList.some(i => ['Ø·Ø¨ÙŠØ¹Ø©', 'Ø¬Ø¨Ø§Ù„', 'Ø¨Ø­Ø±', 'nature'].includes(i));
      const isAdventure = interestsList.some(i => ['Ù…ØºØ§Ù…Ø±Ø©', 'Ø±ÙŠØ§Ø¶Ø©', 'adventure'].includes(i));
      const isFood = interestsList.length === 0 || interestsList.some(i => ['Ø·Ø¹Ø§Ù…', 'food'].includes(i));
      
      const plan = [];
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø¯Ù†
      if (!countryData.cities || countryData.cities.length === 0) {
        console.error('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯Ù† Ù„Ù„Ø¯ÙˆÙ„Ø©:', countryData);
        showMessage('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯Ù† Ù…ØªØ§Ø­Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙˆÙ„Ø©.', 'error');
        return [];
      }
      
      console.log('Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:', days);
      console.log('Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ù…ØªØ§Ø­Ø©:', countryData.cities);
      console.log('Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø«Ù‚Ø§ÙÙŠØ©:', countryData.attractions.cultural);
      console.log('Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©:', countryData.attractions.nature);
      console.log('Ø§Ù„Ù…Ø·Ø§Ø¹Ù…:', countryData.attractions.food);
      
      for (let day = 1; day <= days; day++) {
        const cityIndex = Math.min(day - 1, countryData.cities.length - 1);
        const city = countryData.cities[cityIndex];
        
        console.log(`ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ… ${day} Ù„Ù„Ù…Ø¯ÙŠÙ†Ø© ${city}`);
        
        const dayPlan = {
          day: day,
          city: city,
          morning: [],
          afternoon: [],
          evening: [],
          totalCost: 0,
          route: []
        };
        
        // Ø§Ù„ØµØ¨Ø§Ø­: Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø· Ø«Ù‚Ø§ÙÙŠ
        console.log(`Ø§Ù„ÙŠÙˆÙ… ${day} - isCultural:`, isCultural, 'cultural places:', countryData.attractions.cultural);
        
        if (countryData.attractions.cultural && countryData.attractions.cultural.length > 0) {
          const culturalIndex = (day - 1) % countryData.attractions.cultural.length;
          const placeName = countryData.attractions.cultural[culturalIndex];
          const details = getPlaceDetails(placeName, city, country, 'cultural');
          
          dayPlan.morning.push({
            name: placeName,
            type: 'cultural',
            duration: details.duration || '2-3 Ø³Ø§Ø¹Ø§Øª',
            cost: dailyBudget * 0.25,
            description: details.description,
            activities: details.activities,
            address: details.address,
            bestTime: details.bestTime,
            tips: details.tips
          });
          console.log(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø· ØµØ¨Ø§Ø­ÙŠ: ${placeName}`);
        }
        
        // Ø¨Ø¹Ø¯ Ø§Ù„Ø¸Ù‡Ø±: Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø· Ø·Ø¨ÙŠØ¹Ø©
        console.log(`Ø§Ù„ÙŠÙˆÙ… ${day} - isNature:`, isNature, 'nature places:', countryData.attractions.nature);
        
        if (countryData.attractions.nature && countryData.attractions.nature.length > 0) {
          const natureIndex = (day - 1) % countryData.attractions.nature.length;
          const placeName = countryData.attractions.nature[natureIndex];
          const details = getPlaceDetails(placeName, city, country, 'nature');
          
          dayPlan.afternoon.push({
            name: placeName,
            type: 'nature',
            duration: details.duration || '2-3 Ø³Ø§Ø¹Ø§Øª',
            cost: dailyBudget * 0.25,
            description: details.description,
            activities: details.activities,
            address: details.address,
            bestTime: details.bestTime,
            tips: details.tips
          });
          console.log(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø· Ø¨Ø¹Ø¯ Ø§Ù„Ø¸Ù‡Ø±: ${placeName}`);
        }
        
        // Ø§Ù„Ù…Ø³Ø§Ø¡: Ø¥Ø¶Ø§ÙØ© Ù…Ø·Ø¹Ù…
        console.log(`Ø§Ù„ÙŠÙˆÙ… ${day} - food places:`, countryData.attractions.food);
        
        if (countryData.attractions.food && countryData.attractions.food.length > 0) {
          const foodIndex = (day - 1) % countryData.attractions.food.length;
          const restaurantName = countryData.attractions.food[foodIndex];
          const details = getPlaceDetails(restaurantName, city, country, 'food');
          
          dayPlan.evening.push({
            name: restaurantName,
            type: 'food',
            duration: details.duration || '2 Ø³Ø§Ø¹Ø§Øª',
            cost: dailyBudget * 0.45,
            description: details.description || `Ù…Ø·Ø¹Ù… Ø±Ø§Ù‚ÙŠ ÙÙŠ ${city}`,
            activities: details.activities || ['ØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ø¹Ø´Ø§Ø¡', 'ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø£Ø·Ø¨Ø§Ù‚ Ø§Ù„Ù…Ø­Ù„ÙŠØ©'],
            address: details.address,
            bestTime: details.bestTime,
            tips: details.tips
          });
          console.log(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ø·Ø¹Ù…: ${restaurantName}`);
        } else {
          // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø·Ø§Ø¹Ù…ØŒ Ø£Ø¶Ù Ù…Ø·Ø¹Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠ
          dayPlan.evening.push({
            name: `Ù…Ø·Ø¹Ù… ÙÙŠ ${city}`,
            type: 'food',
            duration: '2 Ø³Ø§Ø¹Ø§Øª',
            cost: dailyBudget * 0.45,
            description: `Ù…Ø·Ø¹Ù… Ø±Ø§Ù‚ÙŠ ÙÙŠ ${city} ÙŠÙ‚Ø¯Ù… Ø£Ø·Ø¨Ø§Ù‚Ø§Ù‹ Ù…Ø­Ù„ÙŠØ© ÙˆØ¹Ø§Ù„Ù…ÙŠØ©`,
            activities: ['ØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ø¹Ø´Ø§Ø¡', 'ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø£Ø·Ø¨Ø§Ù‚ Ø§Ù„Ù…Ø­Ù„ÙŠØ©', 'Ø§Ù„Ø§Ø³ØªÙ…ØªØ§Ø¹ Ø¨Ø§Ù„Ø£Ø¬ÙˆØ§Ø¡'],
            address: `${city}, ${country}`,
            bestTime: '19:00-21:00',
            tips: 'Ø§Ø­Ø¬Ø² Ø·Ø§ÙˆÙ„Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ø®Ø§ØµØ© ÙÙŠ Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹'
          });
          console.log(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ø·Ø¹Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…Ø¯ÙŠÙ†Ø© ${city}`);
        }
        
        console.log(`Ø§Ù„ÙŠÙˆÙ… ${day} - Ø§Ù„Ø£Ù†Ø´Ø·Ø©:`, {
          morning: dayPlan.morning.length,
          afternoon: dayPlan.afternoon.length,
          evening: dayPlan.evening.length
        });
        
        const allPlaces = [
          ...dayPlan.morning.map(a => a.name),
          ...dayPlan.afternoon.map(a => a.name),
          ...dayPlan.evening.map(a => a.name)
        ];
        dayPlan.route = optimizeRoute(allPlaces, allPlaces[0] || '');
        dayPlan.totalCost = dayPlan.morning.reduce((s, a) => s + a.cost, 0) +
                          dayPlan.afternoon.reduce((s, a) => s + a.cost, 0) +
                          dayPlan.evening.reduce((s, a) => s + a.cost, 0);
        
        plan.push(dayPlan);
      }
      
      console.log('Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:', plan);
      console.log('Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… ÙÙŠ Ø§Ù„Ø®Ø·Ø©:', plan.length);
      
      return plan;
    }

    async function displayPlan(plan, country, days, interests, budget) {
      const countryData = await getCountryData(country);
      
      const totalCost = plan.reduce((sum, day) => sum + day.totalCost, 0);
      
      const tripInfo = document.getElementById('tripInfo');
      tripInfo.innerHTML = `
        <div class="plan-info-item">
          <div class="plan-info-label">Ø§Ù„ÙˆØ¬Ù‡Ø©</div>
          <div class="plan-info-value">${country}</div>
          </div>
        <div class="plan-info-item">
          <div class="plan-info-label">Ø§Ù„Ù…Ø¯Ø©</div>
          <div class="plan-info-value">${days} ${days === 1 ? 'ÙŠÙˆÙ…' : 'Ø£ÙŠØ§Ù…'}</div>
          </div>
        <div class="plan-info-item">
          <div class="plan-info-label">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</div>
          <div class="plan-info-value">${budget}</div>
          </div>
        <div class="plan-info-item">
          <div class="plan-info-label">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</div>
          <div class="plan-info-value" style="color: var(--neon-cyan);">$${Math.round(totalCost)}</div>
        </div>
      `;
      
      const dailyPlans = document.getElementById('dailyPlans');
      dailyPlans.innerHTML = plan.map(day => `
        <div class="day-section">
          <div class="day-title">Ø§Ù„ÙŠÙˆÙ… ${day.day} - ${day.city} ($${Math.round(day.totalCost)})</div>
          
          ${day.morning.length > 0 ? `
            <div class="time-slot">
              <div class="time-slot-title">Ø§Ù„ØµØ¨Ø§Ø­</div>
              <div class="time-slot-activities">
                ${day.morning.map(activity => `
                  <div class="activity-item">
                    <div class="activity-name">${activity.name}</div>
                    <div class="activity-details">
                      <div style="margin-bottom: 4px;">${activity.description || ''}</div>
                      <div style="font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 4px;">
                        ${activity.activities ? activity.activities.join(' â€¢ ') : ''}
                      </div>
                      <div style="font-size: 0.7rem;">
                        ${activity.duration} â€¢ $${Math.round(activity.cost)} â€¢ ${activity.bestTime}
                        ${activity.address ? ' â€¢ ' + activity.address : ''}
                      </div>
                      ${activity.tips ? `<div style="font-size: 0.7rem; color: var(--neon-cyan); margin-top: 4px;">ğŸ’¡ ${activity.tips}</div>` : ''}
                    </div>
                        </div>
                            `).join('')}
                        </div>
            </div>
          ` : ''}
          
          ${day.afternoon.length > 0 ? `
            <div class="time-slot">
              <div class="time-slot-title">Ø¨Ø¹Ø¯ Ø§Ù„Ø¸Ù‡Ø±</div>
              <div class="time-slot-activities">
                ${day.afternoon.map(activity => `
                  <div class="activity-item">
                    <div class="activity-name">${activity.name}</div>
                    <div class="activity-details">
                      <div style="margin-bottom: 4px;">${activity.description || ''}</div>
                      <div style="font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 4px;">
                        ${activity.activities ? activity.activities.join(' â€¢ ') : ''}
                      </div>
                      <div style="font-size: 0.7rem;">
                        ${activity.duration} â€¢ $${Math.round(activity.cost)} â€¢ ${activity.bestTime}
                        ${activity.address ? ' â€¢ ' + activity.address : ''}
                      </div>
                      ${activity.tips ? `<div style="font-size: 0.7rem; color: var(--neon-cyan); margin-top: 4px;">ğŸ’¡ ${activity.tips}</div>` : ''}
                    </div>
                        </div>
                            `).join('')}
                        </div>
            </div>
          ` : ''}
          
          ${day.evening.length > 0 ? `
            <div class="time-slot">
              <div class="time-slot-title">Ø§Ù„Ù…Ø³Ø§Ø¡</div>
              <div class="time-slot-activities">
                ${day.evening.map(activity => `
                  <div class="activity-item">
                    <div class="activity-name">${activity.name}</div>
                    <div class="activity-details">
                      <div style="margin-bottom: 4px;">${activity.description || ''}</div>
                      <div style="font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 4px;">
                        ${activity.activities ? activity.activities.join(' â€¢ ') : ''}
                      </div>
                      <div style="font-size: 0.7rem;">
                        ${activity.duration} â€¢ $${Math.round(activity.cost)} â€¢ ${activity.bestTime}
                        ${activity.address ? ' â€¢ ' + activity.address : ''}
                      </div>
                      ${activity.tips ? `<div style="font-size: 0.7rem; color: var(--neon-cyan); margin-top: 4px;">ğŸ’¡ ${activity.tips}</div>` : ''}
                    </div>
                        </div>
                            `).join('')}
                          </div>
                        </div>
                      ` : ''}
        </div>
      `).join('');
      
      document.getElementById('planActions').style.display = 'flex';
      
      const avgDailyCost = totalCost / days;
      
      window.currentPlanData = {
        country: country,
        days: days,
        budget: budget,
        interests: interests,
        plan: plan,
        totalCost: totalCost,
        avgDailyCost: avgDailyCost
      };
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
    (async function initPage() {
      // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† URL
      const params = new URLSearchParams(window.location.search);
      let country = params.get('country') || '';
      const days = parseInt(params.get('days'), 10) || 5;
      const interests = params.get('interests') || 'Ø«Ù‚Ø§ÙØ©ØŒ Ø·Ø¨ÙŠØ¹Ø©';
      const budget = params.get('budget') || 'Ù…ØªÙˆØ³Ø·Ø©';
      
      console.log('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† URL:', { country, days, interests, budget });
      console.log('URL Ø§Ù„ÙƒØ§Ù…Ù„:', window.location.href);
      
      // ØªÙ†Ø¸ÙŠÙ Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆÙ„Ø© Ù…Ù† Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø©
      if (country) {
        country = decodeURIComponent(country).trim();
        console.log('Ø§Ù„Ø¯ÙˆÙ„Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†Ø¸ÙŠÙ:', country);
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¯ÙˆÙ„Ø© Ù…Ø­Ø¯Ø¯Ø©
      if (!country) {
        console.error('Ø§Ù„Ø¯ÙˆÙ„Ø© ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©');
        showMessage('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø¯ÙˆÙ„Ø© Ù…Ù† Ø§Ù„ÙÙˆØ±Ù…', 'error');
        return;
      }

      // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø© ÙÙˆØ±Ø§Ù‹
      try {
        console.log('Ø¨Ø¯Ø¡ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø©:', { country, days, interests, budget });
        const plan = await generateSmartPlan(country, days, interests, budget);
        console.log('Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù…ÙˆÙ„Ø¯Ø©:', plan);
        console.log('Ø·ÙˆÙ„ Ø§Ù„Ø®Ø·Ø©:', plan ? plan.length : 0);
        
        if (plan && plan.length > 0) {
          console.log('Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø·Ø©...');
          await displayPlan(plan, country, days, interests, budget);
        } else {
          console.error('ÙØ´Ù„ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø©. Ø§Ù„Ø®Ø·Ø©:', plan);
          showMessage('ÙØ´Ù„ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¯ÙˆÙ„Ø© Ø¹Ø±Ø¨ÙŠØ© ÙÙŠ Ø¢Ø³ÙŠØ§.', 'error');
        }
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø©:', error);
        console.error('ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:', error.stack);
        showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø©: ' + (error.message || error), 'error');
      }
    })();

    document.getElementById('savePlanBtn').addEventListener('click', async function() {
      if (!window.currentPlanData) {
        showMessage('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø·Ø© Ù„Ø­ÙØ¸Ù‡Ø§', 'error');
        return;
      }

      const result = planManager.savePlan(window.currentPlanData);
      
      if (result.success) {
        showMessage(result.message, 'success');
        this.textContent = 'ØªÙ… Ø§Ù„Ø­ÙØ¸';
        this.disabled = true;
        setTimeout(() => {
          this.textContent = 'Ø­ÙØ¸ Ø§Ù„Ø®Ø·Ø©';
          this.disabled = false;
        }, 3000);
      } else {
        showMessage(result.message, 'error');
      }
    });

    document.getElementById('sharePlanBtn').addEventListener('click', async function() {
      if (!window.currentPlanData) {
        showMessage('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø·Ø© Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©', 'error');
        return;
      }

      try {
        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ù„Ù„Ø®Ø·Ø©
        const planId = planManager.generatePlanId();
        
        // Ø­ÙØ¸ Ø§Ù„Ø®Ø·Ø© ÙÙŠ localStorage Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©
        const plan = {
          id: planId,
          ...window.currentPlanData,
          sharedAt: new Date().toISOString(),
          isShared: true
        };

        // Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®Ø·Ø· Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
        const sharedPlans = JSON.parse(localStorage.getItem('arhgo_shared_plans') || '[]');
        sharedPlans.push(plan);
        localStorage.setItem('arhgo_shared_plans', JSON.stringify(sharedPlans));

        // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
        const baseUrl = window.location.origin + window.location.pathname.replace('smart-planner.html', '');
        const shareLink = `${baseUrl}share-plan.html?id=${planId}`;

        // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Modal Ù…Ø¹ animation
        document.getElementById('shareLinkInput').value = shareLink;
        const modal = document.getElementById('shareModal');
        const modalContent = document.getElementById('shareModalContent');
        modal.style.display = 'flex';
        // Reset animation
        modalContent.style.animation = 'none';
        setTimeout(() => {
          modalContent.style.animation = 'modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
        }, 10);
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø®Ø·Ø©:', error);
        showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø®Ø·Ø©: ' + error.message, 'error');
      }
    });

    // Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù†Ø³Ø®
    document.getElementById('copyLinkBtn').addEventListener('click', async function() {
      const shareLink = document.getElementById('shareLinkInput').value;
      const copyResult = await planManager.copyToClipboard(shareLink);
      
      if (copyResult.success) {
        this.textContent = 'ØªÙ… Ø§Ù„Ù†Ø³Ø®!';
        this.style.background = '#4CAF50';
        setTimeout(() => {
          this.textContent = 'Ù†Ø³Ø®';
          this.style.background = 'var(--neon-cyan)';
        }, 2000);
      } else {
        showMessage('ÙØ´Ù„ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·. ÙŠØ±Ø¬Ù‰ Ù†Ø³Ø®Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹', 'error');
      }
    });

    // Ø¥ØºÙ„Ø§Ù‚ Modal Ù…Ø¹ animation
    document.getElementById('closeShareModal').addEventListener('click', function() {
      const modal = document.getElementById('shareModal');
      const modalContent = document.getElementById('shareModalContent');
      modalContent.style.animation = 'modalSlideOut 0.3s ease-in';
      setTimeout(() => {
        modal.style.display = 'none';
      }, 300);
    });

    // Ø¥ØºÙ„Ø§Ù‚ Modal Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
    document.getElementById('shareModal').addEventListener('click', function(e) {
      if (e.target === this) {
        const modalContent = document.getElementById('shareModalContent');
        modalContent.style.animation = 'modalSlideOut 0.3s ease-in';
        setTimeout(() => {
          this.style.display = 'none';
        }, 300);
      }
    });

    function showMessage(message, type) {
      const messageDiv = document.getElementById('planMessage');
      const colors = {
        success: 'var(--neon-cyan)',
        error: '#FF6B6B',
        info: 'var(--neon-cyan)'
      };
      
      messageDiv.innerHTML = `<div style="color: ${colors[type] || colors.info}; font-weight: 600;">${message}</div>`;
      
      setTimeout(() => {
          messageDiv.innerHTML = '';
      }, 5000);
    }

    // Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    function logoutUser() {
      localStorage.removeItem('arhgo_current_user');
      localStorage.removeItem('loggedIn');
      localStorage.removeItem('session_token');
      if (typeof userAuth !== 'undefined' && userAuth.logout) {
        userAuth.logout();
      }
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function updateAuthUI() {
      const currentUser = localStorage.getItem('arhgo_current_user');
      const loggedIn = localStorage.getItem('loggedIn');
      
      const authButtons = document.getElementById('authButtons');
      const userProfile = document.getElementById('userProfile');
      const userNameDisplay = document.getElementById('userNameDisplay');
      
      if (currentUser || loggedIn) {
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… userAuth Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹
        if (typeof userAuth !== 'undefined') {
          try {
            const isLoggedIn = userAuth.isLoggedIn();
            if (isLoggedIn) {
              const user = userAuth.getCurrentUser();
              if (user) {
                if (authButtons) authButtons.style.display = 'none';
                if (userProfile) {
                  userProfile.style.display = 'flex';
                  if (userNameDisplay) {
                    userNameDisplay.textContent = `ğŸ‘¤ ${user.fullname || user.username || currentUser || loggedIn}`;
                  }
                }
                return;
              }
            }
          } catch (error) {
            console.error('Error with userAuth:', error);
          }
        }
        
        // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† userAuth Ù…ØªØ§Ø­Ø§Ù‹ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage Ù…Ø¨Ø§Ø´Ø±Ø©
        if (authButtons) authButtons.style.display = 'none';
        if (userProfile) {
          userProfile.style.display = 'flex';
          if (userNameDisplay) {
            const allUsers = JSON.parse(localStorage.getItem('arhgo_users') || '[]');
            const user = allUsers.find(u => u.username === (currentUser || loggedIn));
            const displayName = user ? (user.fullname || user.username) : (currentUser || loggedIn);
            userNameDisplay.textContent = `ğŸ‘¤ ${displayName}`;
          }
        }
      } else {
        if (authButtons) authButtons.style.display = 'flex';
        if (userProfile) userProfile.style.display = 'none';
      }
    }

    // ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    updateAuthUI();
    
    // ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± localStorage (Ù…Ù† Ù†Ø§ÙØ°Ø© Ø£Ø®Ø±Ù‰)
    window.addEventListener('storage', updateAuthUI);
    
    // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªØ²Ø§Ù…Ù†
    setInterval(updateAuthUI, 1000);
  </script>
</body>
</html>
