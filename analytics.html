<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ArhGo | Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</title>
  <link rel="stylesheet" href="assets/css/arhgo.css">
  <script src="assets/js/arhgo.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #0A1C2E 0%, #0F1722 30%, #8EA2B6 60%, #C9B27A 100%);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
    }
    
    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    .analytics-container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    
    .analytics-header {
      text-align: center;
      margin-bottom: 40px;
      color: #fff;
    }
    
    .analytics-header h1 {
      font-size: 3.5rem;
      margin-bottom: 16px;
      background: linear-gradient(135deg, #C9B27A, #8EA2B6, #fff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 24px;
      margin-bottom: 40px;
    }
    
    .stat-card {
      background: rgba(242, 244, 247, 0.95);
      border-radius: 24px;
      padding: 32px;
      border: 2px solid rgba(201, 178, 122, 0.3);
      box-shadow: 0 20px 60px rgba(10, 28, 46, 0.3);
      backdrop-filter: blur(20px);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, #C9B27A, #8EA2B6);
    }
    
    .stat-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 30px 80px rgba(10, 28, 46, 0.4);
    }
    
    .stat-icon {
      font-size: 3rem;
      margin-bottom: 16px;
    }
    
    .stat-value {
      font-size: 2.5rem;
      font-weight: 800;
      color: #0A1C2E;
      margin-bottom: 8px;
    }
    
    .stat-label {
      color: #666;
      font-size: 1.1rem;
      font-weight: 600;
    }
    
    .stat-change {
      margin-top: 12px;
      font-size: 0.9rem;
      color: #10B981;
      font-weight: 600;
    }
    
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
      gap: 24px;
      margin-bottom: 40px;
    }
    
    @media (max-width: 1200px) {
      .charts-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .chart-card {
      background: rgba(242, 244, 247, 0.95);
      border-radius: 24px;
      padding: 32px;
      border: 2px solid rgba(201, 178, 122, 0.3);
      box-shadow: 0 20px 60px rgba(10, 28, 46, 0.3);
      backdrop-filter: blur(20px);
    }
    
    .chart-card h3 {
      color: #0A1C2E;
      margin-bottom: 24px;
      font-size: 1.5rem;
      font-weight: 700;
    }
    
    .chart-container {
      position: relative;
      height: 300px;
    }
    
    .table-container {
      background: rgba(242, 244, 247, 0.95);
      border-radius: 24px;
      padding: 32px;
      border: 2px solid rgba(201, 178, 122, 0.3);
      box-shadow: 0 20px 60px rgba(10, 28, 46, 0.3);
      backdrop-filter: blur(20px);
      margin-bottom: 40px;
    }
    
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 24px;
    }
    
    .data-table th,
    .data-table td {
      padding: 16px;
      text-align: right;
      border-bottom: 1px solid rgba(201, 178, 122, 0.2);
    }
    
    .data-table th {
      background: rgba(201, 178, 122, 0.1);
      color: #0A1C2E;
      font-weight: 700;
      font-size: 1.1rem;
    }
    
    .data-table tr:hover {
      background: rgba(201, 178, 122, 0.05);
    }
    
    .export-buttons {
      display: flex;
      gap: 16px;
      margin-top: 24px;
      flex-wrap: wrap;
    }
    
    .pulse-animation {
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
  </style>
</head>
<body class="page-hidden">
  <nav class="arhgo-nav">
    <div class="arhgo-logo">ArhGo</div>
    <ul>
      <li><a data-nav href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
      <li><a data-nav href="smart-planner.html">Ù…ÙˆÙ„Ø¯ Ø®Ø·Ø·</a></li>
      <li><a data-nav href="budget-manager.html">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</a></li>
      <li><a data-nav href="price-comparison.html">Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</a></li>
      <li><a data-nav href="smart-alerts.html">Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</a></li>
    </ul>
  </nav>

  <main class="analytics-container">
    <div class="analytics-header">
      <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©</h1>
      <p style="font-size: 1.3rem; color: rgba(255,255,255,0.9); margin-bottom: 20px;">
        Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø´Ø§Ù…Ù„Ø© ÙˆØªØ­Ù„ÙŠÙ„Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ø±Ø­Ù„Ø§ØªÙƒ
      </p>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">âœˆï¸</div>
        <div class="stat-value" id="totalTrips">0</div>
        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø­Ù„Ø§Øª</div>
        <div class="stat-change pulse-animation">+12% Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">ğŸŒ</div>
        <div class="stat-value" id="totalDestinations">0</div>
        <div class="stat-label">Ø§Ù„ÙˆØ¬Ù‡Ø§Øª Ø§Ù„Ù…Ø²ÙˆØ±Ø©</div>
        <div class="stat-change pulse-animation">+5 ÙˆØ¬Ù‡Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">ğŸ’°</div>
        <div class="stat-value" id="totalSpent">$0</div>
        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
        <div class="stat-change pulse-animation">Ù…ØªÙˆØ³Ø· $120/ÙŠÙˆÙ…</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">â­</div>
        <div class="stat-value" id="avgRating">0.0</div>
        <div class="stat-label">Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</div>
        <div class="stat-change pulse-animation">Ù…Ù† 5.0 â­</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">ğŸ“…</div>
        <div class="stat-value" id="totalDays">0</div>
        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø£ÙŠØ§Ù… Ø§Ù„Ø³ÙØ±</div>
        <div class="stat-change pulse-animation">+18 ÙŠÙˆÙ… Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…</div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">ğŸ¯</div>
        <div class="stat-value" id="savedPlans">0</div>
        <div class="stat-label">Ø§Ù„Ø®Ø·Ø· Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</div>
        <div class="stat-change pulse-animation">+3 Ø®Ø·Ø· Ø¬Ø¯ÙŠØ¯Ø©</div>
      </div>
    </div>

    <div class="charts-grid">
      <div class="chart-card">
        <h3>ğŸ“Š ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙˆØ¬Ù‡Ø§Øª</h3>
        <div class="chart-container">
          <canvas id="destinationsChart"></canvas>
        </div>
      </div>
      
      <div class="chart-card">
        <h3>ğŸ’µ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h3>
        <div class="chart-container">
          <canvas id="expensesChart"></canvas>
        </div>
      </div>
      
      <div class="chart-card">
        <h3>ğŸ“ˆ Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„Ø³ÙØ±</h3>
        <div class="chart-container">
          <canvas id="trendsChart"></canvas>
        </div>
      </div>
      
      <div class="chart-card">
        <h3>ğŸ¯ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø±Ø­Ù„Ø§Øª</h3>
        <div class="chart-container">
          <canvas id="tripTypesChart"></canvas>
        </div>
      </div>
    </div>

    <div class="table-container">
      <h3 style="color: #0A1C2E; margin-bottom: 24px; font-size: 1.5rem;">ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h3>
      <table class="data-table">
        <thead>
          <tr>
            <th>Ø§Ù„ÙˆØ¬Ù‡Ø©</th>
            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…</th>
            <th>Ø§Ù„ØªÙƒÙ„ÙØ©</th>
            <th>Ø§Ù„Ù†ÙˆØ¹</th>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
          </tr>
        </thead>
        <tbody id="tripsTableBody">
          <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
        </tbody>
      </table>
      
      <div class="export-buttons">
        <button class="btn btn-gradient" onclick="exportToPDF()">ğŸ“„ ØªØµØ¯ÙŠØ± PDF</button>
        <button class="btn btn-ghost" onclick="exportToExcel()">ğŸ“Š ØªØµØ¯ÙŠØ± Excel</button>
        <button class="btn btn-ghost" onclick="refreshAnalytics()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
      </div>
    </div>
  </main>

  <script>
    // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage
    function getAnalyticsData() {
      const plans = JSON.parse(localStorage.getItem('arhgo-plans') || '[]');
      const trips = plans.map(plan => ({
        destination: plan.country,
        days: plan.days,
        cost: plan.estimatedCost,
        type: plan.tripType,
        date: new Date(plan.createdAt || Date.now()).toLocaleDateString('ar'),
        rating: (Math.random() * 2 + 3).toFixed(1) // ØªÙ‚ÙŠÙŠÙ… Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¨ÙŠÙ† 3-5
      }));
      
      return {
        trips,
        totalTrips: trips.length,
        totalDestinations: new Set(trips.map(t => t.destination)).size,
        totalSpent: trips.reduce((sum, t) => sum + t.cost, 0),
        totalDays: trips.reduce((sum, t) => sum + t.days, 0),
        avgRating: trips.length > 0 ? (trips.reduce((sum, t) => sum + parseFloat(t.rating), 0) / trips.length).toFixed(1) : 0,
        savedPlans: plans.length
      };
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    function updateStats() {
      const data = getAnalyticsData();
      
      animateValue('totalTrips', 0, data.totalTrips, 1500);
      animateValue('totalDestinations', 0, data.totalDestinations, 1500);
      animateValue('totalSpent', 0, data.totalSpent, 2000, '$');
      animateValue('totalDays', 0, data.totalDays, 1500);
      animateValue('avgRating', 0, parseFloat(data.avgRating), 1500, '', 1);
      animateValue('savedPlans', 0, data.savedPlans, 1500);
    }

    // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
    function animateValue(id, start, end, duration, prefix = '', decimals = 0) {
      const element = document.getElementById(id);
      const range = end - start;
      const increment = range / (duration / 16);
      let current = start;
      
      const timer = setInterval(() => {
        current += increment;
        if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
          current = end;
          clearInterval(timer);
        }
        element.textContent = prefix + current.toFixed(decimals);
      }, 16);
    }

    // Ø±Ø³Ù… Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª
    function drawCharts() {
      const data = getAnalyticsData();
      
      // ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙˆØ¬Ù‡Ø§Øª
      const destinations = {};
      data.trips.forEach(trip => {
        destinations[trip.destination] = (destinations[trip.destination] || 0) + 1;
      });
      
      new Chart(document.getElementById('destinationsChart'), {
        type: 'doughnut',
        data: {
          labels: Object.keys(destinations),
          datasets: [{
            data: Object.values(destinations),
            backgroundColor: [
              '#C9B27A', '#8EA2B6', '#0A1C2E', '#10B981', '#EF4444',
              '#F59E0B', '#8B5CF6', '#EC4899', '#06B6D4', '#84CC16'
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });
      
      // Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©
      const monthlyExpenses = {};
      data.trips.forEach(trip => {
        const month = new Date(trip.date).toLocaleDateString('ar', { month: 'long', year: 'numeric' });
        monthlyExpenses[month] = (monthlyExpenses[month] || 0) + trip.cost;
      });
      
      new Chart(document.getElementById('expensesChart'), {
        type: 'bar',
        data: {
          labels: Object.keys(monthlyExpenses),
          datasets: [{
            label: 'Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª ($)',
            data: Object.values(monthlyExpenses),
            backgroundColor: 'rgba(201, 178, 122, 0.8)',
            borderColor: '#C9B27A',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
      
      // Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„Ø³ÙØ±
      const trends = {};
      data.trips.forEach(trip => {
        const month = new Date(trip.date).toLocaleDateString('ar', { month: 'short' });
        trends[month] = (trends[month] || 0) + 1;
      });
      
      new Chart(document.getElementById('trendsChart'), {
        type: 'line',
        data: {
          labels: Object.keys(trends),
          datasets: [{
            label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø­Ù„Ø§Øª',
            data: Object.values(trends),
            borderColor: '#8EA2B6',
            backgroundColor: 'rgba(142, 162, 182, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          }
        }
      });
      
      // Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø±Ø­Ù„Ø§Øª
      const tripTypes = {};
      data.trips.forEach(trip => {
        tripTypes[trip.type] = (tripTypes[trip.type] || 0) + 1;
      });
      
      new Chart(document.getElementById('tripTypesChart'), {
        type: 'pie',
        data: {
          labels: Object.keys(tripTypes),
          datasets: [{
            data: Object.values(tripTypes),
            backgroundColor: [
              '#C9B27A', '#8EA2B6', '#0A1C2E', '#10B981', '#EF4444'
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
    function updateTable() {
      const data = getAnalyticsData();
      const tbody = document.getElementById('tripsTableBody');
      
      if (data.trips.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø­Ù„Ø§Øª Ø¨Ø¹Ø¯. Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø¬Ø¯ÙŠØ¯Ø©!</td></tr>';
        return;
      }
      
      tbody.innerHTML = data.trips.slice(0, 10).map(trip => `
        <tr>
          <td><strong>${trip.destination}</strong></td>
          <td>${trip.days} ÙŠÙˆÙ…</td>
          <td>$${trip.cost}</td>
          <td>${trip.type}</td>
          <td>${trip.date}</td>
          <td>${trip.rating} â­</td>
        </tr>
      `).join('');
    }

    // ØªØµØ¯ÙŠØ± PDF
    function exportToPDF() {
      alert('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø© ØªØµØ¯ÙŠØ± PDF Ù‚Ø±ÙŠØ¨Ø§Ù‹!');
      // ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© jsPDF Ù‡Ù†Ø§
    }

    // ØªØµØ¯ÙŠØ± Excel
    function exportToExcel() {
      const data = getAnalyticsData();
      let csv = 'Ø§Ù„ÙˆØ¬Ù‡Ø©,Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…,Ø§Ù„ØªÙƒÙ„ÙØ©,Ø§Ù„Ù†ÙˆØ¹,Ø§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„ØªÙ‚ÙŠÙŠÙ…\n';
      data.trips.forEach(trip => {
        csv += `${trip.destination},${trip.days},${trip.cost},${trip.type},${trip.date},${trip.rating}\n`;
      });
      
      const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `arhgo-analytics-${new Date().toISOString().split('T')[0]}.csv`;
      link.click();
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function refreshAnalytics() {
      updateStats();
      drawCharts();
      updateTable();
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        updateStats();
        drawCharts();
        updateTable();
      }, 500);
    });
  </script>
</body>
</html>

